open 02 | lines | each { |line| $line | parse "Game {id}: {draws}" } | flatten | each {|game| ($game.draws | split row ";" | str trim | each {|draw| $draw | split row "," | str trim | each {|cube| $cube | parse "{count} {color}" | first } | reduce -f {} {|cube, game| $game | merge ((try { $cube.count | into int } catch { 0 }) | wrap $cube.color) } } | math max) | merge $game } | each { |game| $game.blue * $game.red * $game.green } | math sum