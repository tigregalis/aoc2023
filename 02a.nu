open 02 | lines | each { |line| $line | parse "Game {id}: {draws}" } | flatten | each {|game| ($game.draws | split row ";" | str trim | each {|draw| $draw | split row "," | str trim | each {|cube| $cube | parse "{count} {color}" | first } | reduce -f {} {|cube, game| $game | merge ((try { $cube.count | into int } catch { 0 }) | wrap $cube.color) } } | math max) | merge $game } | filter {|game| $game.red <= 12 and $game.green <= 13 and $game.blue <= 14  } | select id | get id | each { into int } | math sum